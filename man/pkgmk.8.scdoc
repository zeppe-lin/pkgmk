PKGMK(8)

# NAME

pkgmk - build a software package suitable for installation

# SYNOPSIS

*pkgmk* [*-h* | *-v*]

*pkgmk* [*-cf* _config-file_] *-do* | *-eo* [*-d*] | *-cm* [*-d*] | \
      *-um* [*-d*] | *-uf* | *-utd* | *-c*

*pkgmk* [*-cf* _config-file_] [*-af* _archive-format_] \
      [*-f*] [*-ns*] [*-kw*] [*-d*] [*-im*] [*-if*] [*-in*]

# DESCRIPTION

The *pkgmk* utility builds software into a package archive suitable
for installation with *pkgadd*(8).
Each build is driven by a _Pkgfile_ in the current directory that
defines sources, build steps, and metadata.

*pkgmk* handles downloading missing sources, verifying checksums,
extracting sources into a working directory, executing the build
procedure defined in the _Pkgfile_, and finally packaging the staged
files.

A package is rebuilt only when its sources or _Pkgfile_ have changed,
unless *-f* is specified.
Options override defaults from _pkgmk.conf_(5).

## General options

*-cf* _config-file_, *--config-file*=_config-file_
	Use an alternate configuration file.

	Default: _/etc/pkgmk.conf_.

*-h*, *--help*
	Print usage and exit.

*-v*, *--version*
	Print version and exit.

## One-shot actions

The following options perform a single task and then exit.
Can combine with *-d* where noted.

*-c*, *--clean*
	Remove built package and downloaded sources, then exit.

*-cm*, *--check-md5sum*
	Verify source checksums against _.md5sum_, then exit.

	May be combined with *-d*.

*-do*, *--download-only*
	Download missing sources only, then exit.

*-eo*, *--extract-only*
	Extract sources into the working directory, then exit.

	May be combined with *-d*.

*-uf*, *--update-footprint*
	Update _.footprint_ with the file list from the last built
	package, then exit.

	Use this to accept the previous build when a footprint check
	has failed.

*-um*, *--update-md5sum*
	Regenerate _.md5sum_ from the current sources, then exit.

	May be combined with *-d*.

*-utd*, *--up-to-date*
	Check if the package is up to date, then exit.

## Build modifiers

These options alter how a normal build proceeds.
They may be freely combined.

*-af* _archive-format_, *--archive-format*=_archive-format_
	Use an alternate package archive format.

	Supported formats:

	gnutar
		GNU tar format.
	pax
		POSIX 1003.1-2001 (pax) format.
	ustar
		POSIX 1003.1-1988 (ustar) format.
	v7
		Old V7 tar format.

	See *packages*(7) and *libarchive-formats*(5).

	Default: gnutar.

*-d*, *--download*
	Download missing source files before building.

*-f*, *--force*
	Rebuild even if the package is already up to date.

*-if*, *--ignore-footprint*
	Build without performing a footprint check.

*-im*, *--ignore-md5sum*
	Build without verifying source checksums.

*-in*, *--ignore-new*
	Proceed with build, ignoring new files reported during a
	footprint mismatch.

*-kw*, *--keep-work*
	Keep the temporary working directory after the build
	completes or failures.

*-ns*, *--no-strip*
	Do not strip binaries or libraries.

# FILES

_/etc/pkgmk.conf_
	System-wide configuration file; defines default build,
	packaging, and environment variables.

	See *pkgmk.conf*(5).

The following files reside in the package source directory
(where *pkgmk* is invoked):

_Pkgfile_
	Mandatory build script declaring package metadata, source
	references, and the required *build()* procedure.

	See *pkgmk.Pkgfile*(5).

_.md5sum_
	Optional checksum manifest listing MD5 digests of sources in
	the _Pkgfile_; used to detect accidental corruption or
	mismatched downloads.

	See *pkgmk.md5sum*(5).

_.footprint_
	Optional build manifest recording files, directories, and
	symbolic links produced by the build; used to verify
	reproducibility and detect unexpected changes.

	See *pkgmk.footprint*(5).

_.nostrip_
	Optional user-maintained exclusion list for *strip*(1);
	contains paths or BRE patterns of files that must not be
	stripped.

	See *pkgmk.nostrip*(5).

_.32bit_
	Optional flag file; presence enables 32-bit build mode and
	adjusts compiler, linker, and package environment.

	See *pkgmk.32bit*(5).

# EXIT STATUS

The *pkgmk* utility exits with one of the following values:

*0*
	Success.
*1*
	General error.
*2*
	Invalid _Pkgfile_ (missing required variables or functions).
*3*
	Missing source/build directory or insufficient permissions.
*4*
	Failed to download sources.
*5*
	Failed to unpack sources.
*6*
	MD5 checksum verification failed.
*7*
	Footprint check failed.
*8*
	Error during execution of the *build()* function.
*130*
	Interrupted or terminated by *C-c*.

# SEE ALSO

*pkgmk.conf*(5),
*pkgmk.Pkgfile*(5),
*pkgmk.md5sum*(5),
*pkgmk.footprint*(5),
*pkgmk.nostrip*(5),
*pkgmk.32bit*(5)

*libarchive-formats*(5),
*packages*(7),
*packaging*(7)

; # HISTORY
; 
; The *pkgmk* utility first appeared in CRUX Linux and has been
; maintained and extended in Zeppe-Lin Linux.
; 
; # AUTHORS
; 
; Original implementation by Per Liden and the CRUX team.
; Extended and maintained by Alex Savca and the Zeppe-Lin Linux project.

# SECURITY CONSIDERATIONS

*pkgmk* must *not* be run as the real superuser.
Builds should be performed under *fakeroot*(8) or an equivalent
environment.
Running as root risks allowing untrusted build scripts to alter system
files.

Always confine builds to a dedicated user and controlled working
directory.

; vim: ft=scdoc cc=72 tw=70
